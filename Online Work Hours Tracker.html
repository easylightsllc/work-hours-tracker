<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Work Hours & Pay Tracker (Cloud Connected)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button, select { padding: 8px; margin: 5px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
    #employeeModal, #manageEmployeesModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 2px solid #ccc; z-index: 1000; }
    #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 500; }
    #summaryBox { margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; }
    #employeeBreakdown { margin-top: 10px; }
  </style>
</head>
<body>
<h2>Work Hours & Pay Tracker (Cloud Connected)</h2>
<div id="payPeriod"></div>
<div>
  <select id="employeeSelect">
    <option value="">Select Employee</option>
  </select>
  <button onclick="openEmployeeModal()">Add Employee</button>
  <button onclick="openManageEmployees()">Manage Employees</button>
</div>
<div>
  <input type="date" id="workDate">
  <input type="number" id="hoursWorked" placeholder="Hours Worked" step="0.01">
  <input type="number" id="overrideRate" placeholder="Override Hourly Rate ($)" step="0.01">
  <button onclick="addEntry()">Add Entry</button>
</div>
<div id="summaryBox">
  <strong>Pay Period Totals:</strong><br>
  Total Hours: <span id="totalHours">0</span><br>
  Total Pay Owed: $<span id="totalPay">0.00</span>
  <div id="employeeBreakdown"></div>
</div>
<table>
  <thead>
    <tr>
      <th>Employee Name</th>
      <th>Date</th>
      <th>Hours Worked</th>
      <th>Hourly Rate ($)</th>
      <th>Pay Owed ($)</th>
    </tr>
  </thead>
  <tbody id="entriesTable"></tbody>
</table>
<div id="overlay"></div>
<div id="employeeModal">
  <h3>Add New Employee</h3>
  <input type="text" id="newEmployeeName" placeholder="New Employee Name"><br>
  <input type="number" id="newHourlyRate" placeholder="Hourly Rate ($)" step="0.01"><br>
  <button onclick="saveEmployee()">Save Employee</button>
  <button onclick="closeEmployeeModal()">Cancel</button>
</div>
<div id="manageEmployeesModal">
  <h3>Manage Employees</h3>
  <ul id="employeeList"></ul>
  <button onclick="closeManageEmployees()">Close</button>
</div>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwhxk6LQnGB1pkvQxFYqTfYAHx_VeZQ6-BV15ZhBzeAig6GiZOWIOtOIf1In8Onk97v/exec";
document.addEventListener('DOMContentLoaded', () => {
  loadEmployees();
  showPayPeriod();
  loadEntriesFromSheet();
  document.getElementById('workDate').valueAsDate = new Date();
});


function addEntry() {
  const select = document.getElementById('employeeSelect');
  const name = select.value;
  const defaultRate = parseFloat(select.options[select.selectedIndex]?.getAttribute('data-rate'));
  const overrideRate = parseFloat(document.getElementById('overrideRate').value);
  const date = document.getElementById('workDate').value;
  const hours = parseFloat(document.getElementById('hoursWorked').value);
  const rate = isNaN(overrideRate) ? defaultRate : overrideRate;

  if (!name || !date || isNaN(hours) || isNaN(rate)) {
    alert('Please fill in all fields correctly.');
    return;
  }

  const pay = (hours * rate).toFixed(2);
  const entry = { name, date, hours: hours.toFixed(2), rate: rate.toFixed(2), pay };

  fetch(SCRIPT_URL, {
    method: 'POST',
    body: JSON.stringify(entry),
    headers: { 'Content-Type': 'application/json' }
  })
  .then(response => response.text())
  .then(data => {
    console.log('Success:', data);
    appendEntryToTable(entry);
  })
  .catch(error => console.error('Error!', error.message));

  document.getElementById('workDate').valueAsDate = new Date();
  document.getElementById('hoursWorked').value = '';
  document.getElementById('overrideRate').value = '';
}

function appendEntryToTable(entry) {
  const table = document.getElementById('entriesTable');
  const newRow = table.insertRow();
  newRow.innerHTML = `
    <td>${entry.name}</td>
    <td>${entry.date}</td>
    <td>${entry.hours}</td>
    <td>${entry.rate}</td>
    <td>${entry.pay}</td>
  `;
}
function openEmployeeModal() {
  document.getElementById('overlay').style.display = 'block';
  document.getElementById('employeeModal').style.display = 'block';
}

function closeEmployeeModal() {
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('employeeModal').style.display = 'none';
}

function openManageEmployees() {
  const employees = JSON.parse(localStorage.getItem('employees')) || [];
  const list = document.getElementById('employeeList');
  list.innerHTML = '';
  employees.forEach((emp, index) => {
    const li = document.createElement('li');
    li.innerHTML = `${emp.name} ($${emp.rate}/hr) <button onclick="removeEmployee(${index})">Remove</button>`;
    list.appendChild(li);
  });
  document.getElementById('overlay').style.display = 'block';
  document.getElementById('manageEmployeesModal').style.display = 'block';
}

function closeManageEmployees() {
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('manageEmployeesModal').style.display = 'none';
}

function removeEmployee(index) {
  if (confirm('Are you sure you want to remove this employee?')) {
    const employees = JSON.parse(localStorage.getItem('employees')) || [];
    employees.splice(index, 1);
    localStorage.setItem('employees', JSON.stringify(employees));
    loadEmployees();
    openManageEmployees();
  }
}

function saveEmployee() {
  const name = document.getElementById('newEmployeeName').value.trim();
  const rate = parseFloat(document.getElementById('newHourlyRate').value);
  if (!name || isNaN(rate)) {
    alert('Please enter valid name and rate.');
    return;
  }
  const employees = JSON.parse(localStorage.getItem('employees')) || [];
  employees.push({ name, rate: rate.toFixed(2) });
  localStorage.setItem('employees', JSON.stringify(employees));
  loadEmployees();
  closeEmployeeModal();
  document.getElementById('newEmployeeName').value = '';
  document.getElementById('newHourlyRate').value = '';
}

function loadEmployees() {
  const select = document.getElementById('employeeSelect');
  select.innerHTML = '<option value="">Select Employee</option>';
  const employees = JSON.parse(localStorage.getItem('employees')) || [];
  employees.forEach(emp => {
    const option = document.createElement('option');
    option.value = emp.name;
    option.textContent = `${emp.name} ($${emp.rate}/hr)`;
    option.setAttribute('data-rate', emp.rate);
    select.appendChild(option);
  });
}

function showPayPeriod() {
  const now = new Date();
  const day = now.getDay();
  const diffToThursday = (day >= 4) ? day - 4 : day + 3;
  const start = new Date(now);
  start.setDate(now.getDate() - diffToThursday);
  const end = new Date(start);
  end.setDate(start.getDate() + 6);
  const payday = new Date(end);
  payday.setDate(end.getDate() + 2);

  document.getElementById('payPeriod').innerHTML = `<strong>Current Pay Period:</strong> ${start.toLocaleDateString()} - ${end.toLocaleDateString()} | <strong>Payday:</strong> ${payday.toLocaleDateString()}`;
}
function loadEntriesFromSheet() {
  fetch(SCRIPT_URL)
    .then(response => response.json())
    .then(data => {
      document.getElementById("entriesTable").innerHTML = ""; // Clear table
      data.forEach(entry => {
        appendEntryToTable({
          name: entry[0],
          date: entry[1],
          hours: entry[2],
          rate: entry[3],
          pay: entry[4]
        });
      });
    })
    .catch(error => {
      console.error("Failed to load entries from sheet:", error);
    });
}

</script>
</body>
</html>
